<?php

require_once __DIR__ . '/vendor/autoload.php';

function neo4j_connector_init() {
}

function neo4j_connector_menu() {
  return array(
    'node/%node/graph' => array(
      'type' => MENU_LOCAL_TASK,
      'title' => 'Graph info',
      'page callback' => 'neo4j_connector_node_graph_info_page',
      'page arguments' => array(1),
      'file' => 'neo4j_connector.pages.inc',
      'access callback' => TRUE,
    ),
    'neo4j/console' => array(
      'title' => 'Neo4J db console',
      'page callback' => 'neo4j_connector_console_page',
      'file' => 'neo4j_connector.pages.inc',
      'access callback' => TRUE,
    ),
  );
}

function neo4j_connector_node_insert($node) {
  $indexParam = new Neo4JDrupalIndexParam(NEO4J_CONNECTOR_ENTITY_INDEX, 'entity_id', $node->nid);
  Neo4JDrupal::sharedInstance()->addEntity($node, 'node', neo4j_connector_properties_of_node($node), $indexParam);
}

function neo4j_connector_node_delete($node) {
  $indexParam = new Neo4JDrupalIndexParam(NEO4J_CONNECTOR_ENTITY_INDEX, 'entity_id', $node->nid);
  Neo4JDrupal::sharedInstance()->deleteEntity($node, 'node', $indexParam);
}

function neo4j_connector_node_update($node) {
  $indexParam = new Neo4JDrupalIndexParam(NEO4J_CONNECTOR_ENTITY_INDEX, 'entity_id', $node->nid);
  Neo4JDrupal::sharedInstance()->updateEntity($node, 'node', neo4j_connector_properties_of_node($node), $indexParam);
}

function neo4j_connector_user_insert(&$edit, $account, $category) {
  $indexParam = new Neo4JDrupalIndexParam('user_index', 'user_id', $account->uid);
  Neo4JDrupal::sharedInstance()->addEntity($account, 'user', neo4j_connector_properties_of_user($account), $indexParam);
}

function neo4j_connector_properties_of_user($account) {
  return array(
    'name' => $account->name,
    'mail' => $account->mail,
    'entity_id' => $account->uid,
    'entity_type' => 'user',
  );
}

function neo4j_connector_properties_of_node($node) {
  return array(
    'title' => $node->title,
    'entity_id' => $node->nid,
    'entity_type' => 'node',
    'bundle' => $node->type,
  );
}

function neo4j_connector_cron() {
  // @todo delete single (non-entity) entries.
}
